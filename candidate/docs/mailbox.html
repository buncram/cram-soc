
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>MAILBOX &#8212; Cramium SoC (RISC-V Core Complex)  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/default.js"></script>
    <script type="text/javascript" src="_static/WaveDrom.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="MB_CLIENT" href="mb_client.html" />
    <link rel="prev" title="IRQARRAY9" href="irqarray9.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="mailbox">
<h1>MAILBOX<a class="headerlink" href="#mailbox" title="Permalink to this headline">¶</a></h1>
<div class="section" id="mailbox-an-inter-cpu-mailbox">
<h2>Mailbox: An inter-CPU mailbox<a class="headerlink" href="#mailbox-an-inter-cpu-mailbox" title="Permalink to this headline">¶</a></h2>
<p>The <cite>Mailbox</cite> is a bi-directional, inter-CPU mailbox for delivering messages between CPUs
without requiring shared memory.</p>
<p>A single message consists of a packet up to 1024 words long, where each word is 32 bits in length.</p>
<p>Both CPUs are considered as “peers”; each can initiate a packet at-will.</p>
<p>The bus signal layout is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">layout</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># data going to the peer. `valid` indicates data is ready to be written;</span>
    <span class="c1"># `ready` acknowledges the current write</span>
    <span class="p">(</span><span class="s2">&quot;w_dat&quot;</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">DIR_M_TO_S</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;w_valid&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">DIR_M_TO_S</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;w_ready&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">DIR_S_TO_M</span><span class="p">),</span>
    <span class="c1"># Interrupt signal to peer.</span>
    <span class="c1"># A single pulse used to indicate when the full packet is in the FIFO.</span>
    <span class="p">(</span><span class="s2">&quot;w_done&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">DIR_M_TO_S</span><span class="p">),</span>
    <span class="c1"># data coming from the peer</span>
    <span class="p">(</span><span class="s2">&quot;r_dat&quot;</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">DIR_S_TO_M</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;r_valid&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">DIR_S_TO_M</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;r_ready&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">DIR_M_TO_S</span><span class="p">),</span>
    <span class="c1"># Interrupt signal from peer.</span>
    <span class="c1"># A single pulse used to indicate when the full packet is in the FIFO.</span>
    <span class="p">(</span><span class="s2">&quot;r_done&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">DIR_S_TO_M</span><span class="p">),</span>
    <span class="c1"># Bi-directional sync signal. This can be used at any time to recover the protocol</span>
    <span class="c1"># to a known state.</span>
    <span class="c1"># The signal is cross-wired, e.g. `w_abort` on one peer connects to `r_abort` on</span>
    <span class="c1"># the other. Either peer can assert `w_abort`, and it must stay asserted until</span>
    <span class="c1"># `r_abort` is pulsed to acknowledge the abort.</span>
    <span class="c1"># Asserting `w_abort` immediately clears the sender&#39;s FIFO, and blocks new data</span>
    <span class="c1"># from being loaded until `r_abort` is asserted.</span>
    <span class="c1"># In the case that both happen to simultaneously assert `w_abort`,</span>
    <span class="c1"># the protocol completes in one cycle.</span>
    <span class="p">(</span><span class="s2">&quot;w_abort&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">DIR_M_TO_S</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;r_abort&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">DIR_S_TO_M</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="data-transfer-protocol">
<h2>Data Transfer Protocol<a class="headerlink" href="#data-transfer-protocol" title="Permalink to this headline">¶</a></h2>
<p>The protocol has two levels, one at a MAC level, and one at an APP level.</p>
<p>The MAC level protocol controls synchronization of data transfer, and the transfer of single, fully-formed
packets between the devices. The MAC protocol is implemented by this hardware block.</p>
<p>The APP protocol is managed by the operating system, and can be considered advisory as
just one of many ways to use this system to communicate between CPUs. However, it helps to ground
the protocol in an APP framework as some details of the MAC impact the APP framework, especially
around synchronization and conflict avoidance.</p>
<p>Each peer has a channel to write data to the other peer, using 32 bits <cite>dat</cite>, one <cite>valid</cite> to
indicate when data is available, and <cite>ready</cite> to indicate when the data has been latched by
the corresponding peer’s hardware FIFO. Generally, <cite>valid</cite>/<cite>ready</cite> is managed exclusively by
hardware state machines and the host CPUs are not aware of these signals; they mainly exist
to avoid overflowing the FIFO in the case that one is pipelining multiple packets through
the interface.</p>
<p>There is an additional <cite>done</cite> signal which is asserted for exactly one cycle, and it indicates
to the other peer that the sender has finished writing all the data for a given packet. The <cite>done</cite>
signal is provided so that the corresponding peer does not need to busy-monitor the FIFO depth.</p>
<blockquote>
<div>
<div style="overflow-x:auto">
<script type="WaveDrom">
{ "signal" : [
    {"name": "clk",       "wave": "p........" },
    {"name": "dat",       "wave": "x=.x===xx", "data" : ["D0", "D1", "D2", "D3", "D4"]},
    {"name": "valid",     "wave": "01.01..0."},
    {"name": "ready",     "wave": "0.101..0."},
    {"name": "done",      "wave": "0......10"},
]}
</script>
</div>
</div></blockquote>
<p>The above example shows a packet with a length of four words being transmitted. The first word
takes an extra cycle to be acknowledged; the remaining three are immediately accepted. The <cite>done</cite>
signal could come as early as simultaneously with the last <cite>ready</cite>, but in practice it comes a couple
cycles later since it would be triggered by a write from the CPU to the <cite>done</cite> register.</p>
<p>The data transfer protocol is symmetric across the peers.</p>
</div>
<div class="section" id="abort-protocol">
<h2>Abort Protocol<a class="headerlink" href="#abort-protocol" title="Permalink to this headline">¶</a></h2>
<p>The abort protocol is used to recover the protocol to a known state: all FIFOs empty, and both hosts
state machines in an idle state. This is accomplished by cross-wiring <cite>w_abort</cite> on the sending
peer to <cite>r_abort</cite> on the corresponding peer. Either peer can assert <cite>w_abort</cite>, and it must stay asserted
until <cite>r_abort</cite> is pulsed to acknowledged the abort condition. At the conclusion of the protocol,
both FIFOs are empty and their protocol state machines are idle.</p>
<blockquote>
<div>
<div style="overflow-x:auto">
<script type="WaveDrom">
{ "config": {skin : "default"},
"signal" : [
    {"name": "clk",          "wave": "p.....|......."},
    {"name": "w_cpu_op",     "wave": "=.=...........", "node": "...........", "data" : ["initiate abort", "XXX"]},
  {"name": "w_abort_done_int", "wave": "0.........10..", "node": "..........g"},
    {"name": "w_abort",      "wave": "0.1...|...0...", "node": "..a........"},
    {"name": "r_abort",      "wave": "0.....|..10...", "node": ".........e."},
    {},
    {"name": "w_state",      "wave": "=.=...|...=...", "data" : ["XXX", "REQ    ", "IDLE"]},
    {"name": "w_fifo",       "wave": "x..=..|.......", "node": "...b.....", "data" : ["EMPTY        "]},
    {},
    {"name": "r_cpu_op",     "wave": "=.....|.==....", "node": "...........", "data" : ["XXX", "ack", "XXX"]},
    {"name": "r_state",      "wave": "=...=.|...=...", "data" : ["XXX", "ACK", "IDLE"], "node": "....d..."},
    {"name": "r_fifo",       "wave": "x.....|...=...", "data" : ["EMPTY"], "node": "..........f.."},
    {"name": "r_abort_int",  "wave": "0..10.|.......", "node": "...c......"},
],
  "edge" : ['a->b hw enforced', 'a->c', 'c->d ', 'd~->e IRQ handler latency', 'e->f hw enforced', 'e->g ']}
</script>
</div>
</div></blockquote>
<p>In the diagram above, the initiating peer is the <cite>w_</cite> signal set, and the corresponding peer is the <cite>r_</cite> signal
set. Here, the <cite>w_</cite> CPU issues a write operation by writing <cite>1</cite> to the <cite>control</cite> CSR’s <cite>abort</cite> bit. This
results in <cite>w_abort</cite> being asserted and held, while simultaneously both the receive and send FIFOs
being cleared and refusing to accept any further data. The assertion of <cite>w_abort</cite> is received by the
corresponding peer, which triggers an interrupt (rendered as a single pulse <cite>r_abort_int</cite>; but the <cite>pending</cite> bit
is sticky until cleared).</p>
<p>The link stays in this state until the receiver’s main loop or IRQ handler
runs and acknowledges the abort condition by writing to its <cite>control</cite> CSR <cite>abort</cite> bit. Note that the
IRQ handler has to be written such that any in-progress operation is truly aborted. Thus, a peer’s
FIFO interaction code should probably be written as follows:</p>
<ol class="arabic simple">
<li>Main loop decides it needs to interact with the FIFO</li>
<li>Disable abort response IRQ</li>
<li>Interact with the FIFO</li>
<li>Re-enable abort response IRQ; at which point an IRQ would fire triggering the abort response</li>
<li>Inside the abort response IRQ, side-effect any state machine variables back to an initial state</li>
<li>Resume main loop code, which should now check &amp; handle any residual clean-up from an abort</li>
</ol>
<p>At this point, both sides drop their <cite>abort</cite> signals, both state machines return to an <cite>IDLE</cite> state, and
all FIFOs are empty. An <cite>abort_done</cite> interrupt is triggered, but it may be masked and polled if the
initiating CPU prefers to monitor the abort by polling.</p>
<p>In order to make the case work where both peers attempt to initiate an abort at the same time, the
initiator guarantees that on asserting <cite>w_abort</cite> it is immediately ready to act on an <cite>r_abort</cite> pulse.
This means the hardware guarantees two things:</p>
<ul>
<li><p class="first">All FIFOs are cleared by the request</p>
</li>
<li><p class="first">The incoming <cite>abort</cite> response line is prevented from generating an interrupt</p>
<blockquote>
<div>
<div style="overflow-x:auto">
<script type="WaveDrom">
{ "config": {skin : "default"},
"signal" : [
    {"name": "clk",          "wave": "p....."},
    {"name": "w_abort",      "wave": "0.10.."},
    {"name": "r_abort",      "wave": "0.10.."},
    {},
    {"name": "w_cpu_op",     "wave": "=.=...", "data" : ["initiate abort", "XXX"]},
    {"name": "w_abort_done_int", "wave": "0..10."},
    {"name": "w_abort_int",  "wave": "0....."},
    {"name": "w_state",      "wave": "=.==..", "data" : ["XXX", "REQ", "IDLE"]},
    {"name": "w_fifo",       "wave": "x..=..", "data" : ["EMPTY"]},
    {},
    {"name": "r_cpu_op",     "wave": "=.=...", "data" : ["initiate abort", "XXX"]},
    {"name": "r_abort_done_int", "wave": "0..10."},
    {"name": "r_abort_int",  "wave": "0....."},
    {"name": "r_state",      "wave": "=.==..", "data" : ["XXX", "REQ", "IDLE"]},
    {"name": "r_fifo",       "wave": "x..=..", "data" : ["EMPTY"]},
]}
</script>
</div>
</div></blockquote>
</li>
</ul>
<p>Above is the rare edge case of a cycle-perfect simultaneous abort request. It “just works”, and
both devices immediately transition from <cite>REQ</cite> -&gt; <cite>IDLE</cite>, without either going through <cite>ACK</cite>.</p>
<blockquote>
<div>
<div style="overflow-x:auto">
<script type="WaveDrom">
{ "config": {skin : "default"},
"signal" : [
    {"name": "clk",          "wave": "p.......|.."},
    {"name": "w_abort",      "wave": "0.1...0.|.."},
    {"name": "r_abort",      "wave": "0....10.|.."},
    {},
  {"name": "w_cpu_op",     "wave": "==......|..", "data" : ["initiate", "XXX"], "node" : ".a"},
    {"name": "w_abort_done_int", "wave": "0.....10|.."},
    {"name": "w_abort_int",  "wave": "0.......|.."},
    {"name": "w_abort_ack",  "wave": "x.0.....|.."},
    {"name": "w_state",      "wave": "=..=..=.|..", "data" : ["XXX", "REQ", "IDLE"]},
    {"name": "w_fifo",       "wave": "x..=....|..", "data" : ["EMPTY"]},
    {},
    {"name": "r_cpu_op",     "wave": "=.=..=..|..", "data" : ["XXX", "initiate", "XXX"], "node" : "..c"},
    {"name": "r_abort_done_int", "wave": "0.....10|.."},
    {"name": "r_abort_int",  "wave": "0.10....|..", "node" : "..b"},
    {"name": "r_abort_ack",  "wave": "x....1..|..", "node" : "..........e"},
  {"name": "r_state",      "wave": "=..=..=.|=.", "data" : ["XXX", "ACK", "IDLE", "HANDLER"], "node" : ".........d"},
    {"name": "r_fifo",       "wave": "x....=..|..", "data" : ["EMPTY"]},
], "edge" : ['a->b race condition', 'a-~>c ', "d-~>e "]}
</script>
</div>
</div></blockquote>
<p>Above is the more common edge case where one peer has initiated an abort, and the other
is preparing to initiate at the same time, but is perhaps a cycle or two later. In this case,
the late peer would have an interrupt initiated simultaneously with an abort initiation, which
would result in the <cite>HANDLER</cite> code running, in this case, the <strong>abort initiator</strong> handler
code (not the <strong>abort done</strong> handler).</p>
<p>A naive implementation would re-issue the <cite>abort</cite> bit, triggering the first peer to respond,
and the two could ping-pong back and forth in an infinite cycle.</p>
<p>In order to break the cycle, an additional “abort acknowledged” (<cite>abort_ack</cite>) signal is
provided, which is set in the case that the respective peer is responding to
a request (thus, it would be set for both peers in the above case of the “perfectly aligned”
abort request; but more typically it is cleared by the first initiator, and set for the later
initiator). The abort handler thus shall always check the <cite>abort_ack</cite> signal, and in the case
that it is set, it will not re-acknowledge a previously acknowledged abort, and avoiding
an abort storm.</p>
</div>
<div class="section" id="application-protocol">
<h2>Application Protocol<a class="headerlink" href="#application-protocol" title="Permalink to this headline">¶</a></h2>
<p>The application protocol wraps a packet format around each packet. The general format of
a packet is as follows:</p>
<ul class="simple">
<li>Word 0<ul>
<li>Bit 31 - set if a response; cleared if initiating</li>
<li>Bit 30:16 - sequence number</li>
<li>Bit 15:10 - tag</li>
<li>Bit 9:0 - length in words of the packet, excluding word 0</li>
</ul>
</li>
</ul>
<p>The sequence number allows responses to occur out of order with respect to requests.</p>
<p>The tag encodes the operation intended by the packet. Within the tag, further meaning
may be ascribed to later fields in the packet. As an example, a <cite>tag</cite> of 0 could indicate
an RPC, and in this case <cite>word 1</cite> would encode the desired system call, and then
the subsequent words would encode arguments to that system call. After processing the data,
the response to this system call would be returned to the corresponding peer, using the same
<cite>tag</cite> and <cite>sequence number</cite>, but with the <cite>response</cite> bit set.</p>
<p>Further definition of the protocol would extend from here, for example, a <cite>send</cite> of data
could use a tag of <cite>1</cite>, and the response would be with the same tag
and sequence number to acknowledge that the sent data was accepted, with the length
field specifying the number of words that were accepted.</p>
</div>
<div class="section" id="register-listing-for-mailbox">
<h2>Register Listing for MAILBOX<a class="headerlink" href="#register-listing-for-mailbox" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="55%" />
<col width="45%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Register</th>
<th class="head">Address</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="#mailbox-wdata"><span class="std std-ref">MAILBOX_WDATA</span></a></td>
<td><a class="reference internal" href="#mailbox-wdata"><span class="std std-ref">0x58018000</span></a></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#mailbox-rdata"><span class="std std-ref">MAILBOX_RDATA</span></a></td>
<td><a class="reference internal" href="#mailbox-rdata"><span class="std std-ref">0x58018004</span></a></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#mailbox-ev-status"><span class="std std-ref">MAILBOX_EV_STATUS</span></a></td>
<td><a class="reference internal" href="#mailbox-ev-status"><span class="std std-ref">0x58018008</span></a></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#mailbox-ev-pending"><span class="std std-ref">MAILBOX_EV_PENDING</span></a></td>
<td><a class="reference internal" href="#mailbox-ev-pending"><span class="std std-ref">0x5801800c</span></a></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#mailbox-ev-enable"><span class="std std-ref">MAILBOX_EV_ENABLE</span></a></td>
<td><a class="reference internal" href="#mailbox-ev-enable"><span class="std std-ref">0x58018010</span></a></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#mailbox-status"><span class="std std-ref">MAILBOX_STATUS</span></a></td>
<td><a class="reference internal" href="#mailbox-status"><span class="std std-ref">0x58018014</span></a></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#mailbox-control"><span class="std std-ref">MAILBOX_CONTROL</span></a></td>
<td><a class="reference internal" href="#mailbox-control"><span class="std std-ref">0x58018018</span></a></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#mailbox-done"><span class="std std-ref">MAILBOX_DONE</span></a></td>
<td><a class="reference internal" href="#mailbox-done"><span class="std std-ref">0x5801801c</span></a></td>
</tr>
</tbody>
</table>
<div class="section" id="mailbox-wdata">
<h3>MAILBOX_WDATA<a class="headerlink" href="#mailbox-wdata" title="Permalink to this headline">¶</a></h3>
<p><cite>Address: 0x58018000 + 0x0 = 0x58018000</cite></p>
<blockquote>
<div><p>Write data to outgoing FIFO.</p>

<div style="overflow-x:auto">
<script type="WaveDrom">
{
    "reg": [
        {"name": "wdata[31:0]", "bits": 32}
    ], "config": {"hspace": 400, "bits": 32, "lanes": 1 }, "options": {"hspace": 400, "bits": 32, "lanes": 1}
}
</script>
</div>
</div></blockquote>
</div>
<div class="section" id="mailbox-rdata">
<h3>MAILBOX_RDATA<a class="headerlink" href="#mailbox-rdata" title="Permalink to this headline">¶</a></h3>
<p><cite>Address: 0x58018000 + 0x4 = 0x58018004</cite></p>
<blockquote>
<div><p>Read data from incoming FIFO.</p>

<div style="overflow-x:auto">
<script type="WaveDrom">
{
    "reg": [
        {"name": "rdata[31:0]", "bits": 32}
    ], "config": {"hspace": 400, "bits": 32, "lanes": 1 }, "options": {"hspace": 400, "bits": 32, "lanes": 1}
}
</script>
</div>
</div></blockquote>
</div>
<div class="section" id="mailbox-ev-status">
<h3>MAILBOX_EV_STATUS<a class="headerlink" href="#mailbox-ev-status" title="Permalink to this headline">¶</a></h3>
<p><cite>Address: 0x58018000 + 0x8 = 0x58018008</cite></p>
<blockquote>
<div><p>Triggers if either <cite>tx_err</cite> or <cite>rx_err</cite> are asserted</p>

<div style="overflow-x:auto">
<script type="WaveDrom">
{
    "reg": [
        {"name": "available",  "bits": 1},
        {"name": "abort_init",  "bits": 1},
        {"name": "abort_done",  "bits": 1},
        {"name": "error",  "bits": 1},
        {"bits": 28}
    ], "config": {"hspace": 400, "bits": 32, "lanes": 4 }, "options": {"hspace": 400, "bits": 32, "lanes": 4}
}
</script>
</div>
</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="22%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>[0]</td>
<td>AVAILABLE</td>
<td>Level of the <code class="docutils literal notranslate"><span class="pre">available</span></code> event</td>
</tr>
<tr class="row-odd"><td>[1]</td>
<td>ABORT_INIT</td>
<td>Level of the <code class="docutils literal notranslate"><span class="pre">abort_init</span></code> event</td>
</tr>
<tr class="row-even"><td>[2]</td>
<td>ABORT_DONE</td>
<td>Level of the <code class="docutils literal notranslate"><span class="pre">abort_done</span></code> event</td>
</tr>
<tr class="row-odd"><td>[3]</td>
<td>ERROR</td>
<td>Level of the <code class="docutils literal notranslate"><span class="pre">error</span></code> event</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mailbox-ev-pending">
<h3>MAILBOX_EV_PENDING<a class="headerlink" href="#mailbox-ev-pending" title="Permalink to this headline">¶</a></h3>
<p><cite>Address: 0x58018000 + 0xc = 0x5801800c</cite></p>
<blockquote>
<div><p>Triggers if either <cite>tx_err</cite> or <cite>rx_err</cite> are asserted</p>

<div style="overflow-x:auto">
<script type="WaveDrom">
{
    "reg": [
        {"name": "available",  "bits": 1},
        {"name": "abort_init",  "bits": 1},
        {"name": "abort_done",  "bits": 1},
        {"name": "error",  "bits": 1},
        {"bits": 28}
    ], "config": {"hspace": 400, "bits": 32, "lanes": 4 }, "options": {"hspace": 400, "bits": 32, "lanes": 4}
}
</script>
</div>
</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="12%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>[0]</td>
<td>AVAILABLE</td>
<td>Triggers when the <cite>done</cite> signal was asserted by the corresponding peer</td>
</tr>
<tr class="row-odd"><td>[1]</td>
<td>ABORT_INIT</td>
<td>Triggers when abort is asserted by the peer, and there is currently no abort in
progress</td>
</tr>
<tr class="row-even"><td>[2]</td>
<td>ABORT_DONE</td>
<td>Triggers when a previously initiated abort is acknowledged by peer</td>
</tr>
<tr class="row-odd"><td>[3]</td>
<td>ERROR</td>
<td>Triggers if either <cite>tx_err</cite> or <cite>rx_err</cite> are asserted</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mailbox-ev-enable">
<h3>MAILBOX_EV_ENABLE<a class="headerlink" href="#mailbox-ev-enable" title="Permalink to this headline">¶</a></h3>
<p><cite>Address: 0x58018000 + 0x10 = 0x58018010</cite></p>
<blockquote>
<div><p>Triggers if either <cite>tx_err</cite> or <cite>rx_err</cite> are asserted</p>

<div style="overflow-x:auto">
<script type="WaveDrom">
{
    "reg": [
        {"name": "available",  "bits": 1},
        {"name": "abort_init",  "bits": 1},
        {"name": "abort_done",  "bits": 1},
        {"name": "error",  "bits": 1},
        {"bits": 28}
    ], "config": {"hspace": 400, "bits": 32, "lanes": 4 }, "options": {"hspace": 400, "bits": 32, "lanes": 4}
}
</script>
</div>
</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="17%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>[0]</td>
<td>AVAILABLE</td>
<td>Write a <code class="docutils literal notranslate"><span class="pre">1</span></code> to enable the <code class="docutils literal notranslate"><span class="pre">available</span></code> Event</td>
</tr>
<tr class="row-odd"><td>[1]</td>
<td>ABORT_INIT</td>
<td>Write a <code class="docutils literal notranslate"><span class="pre">1</span></code> to enable the <code class="docutils literal notranslate"><span class="pre">abort_init</span></code> Event</td>
</tr>
<tr class="row-even"><td>[2]</td>
<td>ABORT_DONE</td>
<td>Write a <code class="docutils literal notranslate"><span class="pre">1</span></code> to enable the <code class="docutils literal notranslate"><span class="pre">abort_done</span></code> Event</td>
</tr>
<tr class="row-odd"><td>[3]</td>
<td>ERROR</td>
<td>Write a <code class="docutils literal notranslate"><span class="pre">1</span></code> to enable the <code class="docutils literal notranslate"><span class="pre">error</span></code> Event</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mailbox-status">
<h3>MAILBOX_STATUS<a class="headerlink" href="#mailbox-status" title="Permalink to this headline">¶</a></h3>
<p><cite>Address: 0x58018000 + 0x14 = 0x58018014</cite></p>
<blockquote>
<div>
<div style="overflow-x:auto">
<script type="WaveDrom">
{
    "reg": [
        {"name": "rx_words",  "bits": 11},
        {"name": "tx_words",  "bits": 11},
        {"name": "abort_in_progress",  "bits": 1},
        {"name": "abort_ack",  "bits": 1},
        {"name": "tx_err",  "bits": 1},
        {"name": "rx_err",  "bits": 1},
        {"bits": 6}
    ], "config": {"hspace": 400, "bits": 32, "lanes": 4 }, "options": {"hspace": 400, "bits": 32, "lanes": 4}
}
</script>
</div>
</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="17%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>[10:0]</td>
<td>RX_WORDS</td>
<td>Number of words available to read</td>
</tr>
<tr class="row-odd"><td>[21:11]</td>
<td>TX_WORDS</td>
<td>Number of words pending in write FIFO. Free space is 1024 - <cite>tx_avail</cite></td>
</tr>
<tr class="row-even"><td>[22]</td>
<td>ABORT_IN_PROGRESS</td>
<td>This bit is set if an <cite>aborting</cite> event was initiated and is still in progress.</td>
</tr>
<tr class="row-odd"><td>[23]</td>
<td>ABORT_ACK</td>
<td>This bit is set by the peer that acknowledged the incoming abort (the later of
the two, in case of an imperfect race condition). The abort response handler
should check this bit; if it is set, no new acknowledgement shall be issued. The
bit is cleared when an initiator initiates a new abort. The initiator shall also
ignore the state of this bit if it is intending to initiate a new abort cycle.</td>
</tr>
<tr class="row-even"><td>[24]</td>
<td>TX_ERR</td>
<td>Set if the write FIFO overflowed because we wrote too much data. Cleared on
register read.</td>
</tr>
<tr class="row-odd"><td>[25]</td>
<td>RX_ERR</td>
<td>Set if read FIFO underflowed because we read too much data. Cleared on register
read.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mailbox-control">
<h3>MAILBOX_CONTROL<a class="headerlink" href="#mailbox-control" title="Permalink to this headline">¶</a></h3>
<p><cite>Address: 0x58018000 + 0x18 = 0x58018018</cite></p>
<blockquote>
<div>
<div style="overflow-x:auto">
<script type="WaveDrom">
{
    "reg": [
        {"name": "abort",  "type": 4, "bits": 1},
        {"bits": 31}
    ], "config": {"hspace": 400, "bits": 32, "lanes": 4 }, "options": {"hspace": 400, "bits": 32, "lanes": 4}
}
</script>
</div>
</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="7%" />
<col width="85%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>[0]</td>
<td>ABORT</td>
<td><p class="first">Write <cite>1</cite> to this field to both initiate and acknowledge an abort. Empties both
FIFOs, asserts <cite>aborting</cite>, and prevents an interrupt from being generated by an
incoming abort request. New reads &amp; writes are ignored until <cite>aborted</cite> is
asserted from the peer.</p>
<p class="last">Writing a 1 to this bit triggers the function.</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mailbox-done">
<h3>MAILBOX_DONE<a class="headerlink" href="#mailbox-done" title="Permalink to this headline">¶</a></h3>
<p><cite>Address: 0x58018000 + 0x1c = 0x5801801c</cite></p>
<blockquote>
<div>
<div style="overflow-x:auto">
<script type="WaveDrom">
{
    "reg": [
        {"name": "done",  "type": 4, "bits": 1},
        {"bits": 31}
    ], "config": {"hspace": 400, "bits": 32, "lanes": 4 }, "options": {"hspace": 400, "bits": 32, "lanes": 4}
}
</script>
</div>
</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="6%" />
<col width="86%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>[0]</td>
<td>DONE</td>
<td><p class="first">Writing a <cite>1</cite> to this field indicates to the corresponding peer that a full
packet is done loading. There is no need to clear this register after writing.</p>
<p class="last">Writing a 1 to this bit triggers the function.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Cramium SoC (RISC-V Core Complex)</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="interrupts.html">Interrupt Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpu.html">CPU</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="d11ctime.html">D11CTIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="susres.html">SUSRES</a></li>
<li class="toctree-l1"><a class="reference internal" href="coreuser.html">COREUSER</a></li>
<li class="toctree-l1"><a class="reference internal" href="csrtest.html">CSRTEST</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray0.html">IRQARRAY0</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray1.html">IRQARRAY1</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray10.html">IRQARRAY10</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray11.html">IRQARRAY11</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray12.html">IRQARRAY12</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray13.html">IRQARRAY13</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray14.html">IRQARRAY14</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray15.html">IRQARRAY15</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray16.html">IRQARRAY16</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray17.html">IRQARRAY17</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray18.html">IRQARRAY18</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray19.html">IRQARRAY19</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray2.html">IRQARRAY2</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray3.html">IRQARRAY3</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray4.html">IRQARRAY4</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray5.html">IRQARRAY5</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray6.html">IRQARRAY6</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray7.html">IRQARRAY7</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray8.html">IRQARRAY8</a></li>
<li class="toctree-l1"><a class="reference internal" href="irqarray9.html">IRQARRAY9</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">MAILBOX</a></li>
<li class="toctree-l1"><a class="reference internal" href="mb_client.html">MB_CLIENT</a></li>
<li class="toctree-l1"><a class="reference internal" href="resetvalue.html">RESETVALUE</a></li>
<li class="toctree-l1"><a class="reference internal" href="ticktimer.html">TICKTIMER</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="irqarray9.html" title="previous chapter">IRQARRAY9</a></li>
      <li>Next: <a href="mb_client.html" title="next chapter">MB_CLIENT</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Cramium, Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="_sources/mailbox.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>